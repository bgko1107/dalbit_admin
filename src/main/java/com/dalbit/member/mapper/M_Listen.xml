<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalbit.member.dao.M_ListenDao" >

    <select id="callListenList" parameterType="com.dalbit.member.vo.ListenListVo" resultType="com.dalbit.member.vo.ListenListVo">
        /* M_Listen.xml - callListenList */
        SELECT
          basic.subject_type
          , basic.title
          , listen.start_date
          , listen.end_date
          , listen.listentime
          , listen.gift_ruby
          , member.mem_nick
          , @RNUM := @RNUM + 1 as rowNum
        FROM tb_member_broadcast_basic basic
          , tb_member_broadcast_broadcasting broad
          , tb_member_broadcast_listening listen
          , tb_member_basic member
          , (SELECT @RNUM := #{pageStart}) r
        WHERE basic.mem_no = broad.mem_no
          AND broad.room_no = listen.room_no
          AND listen.mem_no = member.mem_no

      ORDER BY ${orderColumnName} ${orderDir}
       limit #{pageStart}, #{pageCnt}
    </select>

    <select id="callListenHistory_detail" parameterType="com.dalbit.member.vo.ListenListVo" resultType="com.dalbit.member.vo.ListenListVo">
      /* M_Listen.xml - callListenHistory_detail */
        select b.room_no  as roomNo
                ,(SELECT c.code FROM tbl_code_define c WHERE c.type = 'subject_type' AND c.value = b.subject_type)   as subjectType
                ,b.title           as title
                ,DATE_FORMAT(a.start_date, '%Y-%m-%d %H:%i:%s')                     as startDate
                ,DATE_FORMAT(a.end_date, '%Y-%m-%d %H:%i:%s')                       as endDate
                ,TIME_FORMAT(SEC_TO_TIME(a.listentime), '%H시간 %i분 %s초')  as listenTime /*읽힘*/
                ,(select mem_id from tb_member_basic where mem_no = b.mem_no)    as memId
                ,(select mem_nick from tb_member_basic where mem_no = b.mem_no)  as memNick
                ,ruby   as ruby
          from tb_member_broadcast_listening a left join (select room_no, title, mem_no, subject_type from tb_broadcast_room) b
            on a.room_no = b.room_no
         where a.mem_no = #{memNo}
    </select>

</mapper>