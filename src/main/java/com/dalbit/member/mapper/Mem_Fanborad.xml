<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalbit.member.dao.Mem_FanboardDao" >

    <!--<select id="callFanboardHistory" statementType="CALLABLE" parameterType="com.dalbit.common.vo.ProcedureVo" resultType="com.dalbit.member.vo.procedure.P_MemberFanboardOutputVo">-->
        <!--/* Mem_Fanboardt.xml - callFanboardHistory */-->
        <!--call rd_admin.sp_admin_member_fanboard_history(#{data, mode=IN, jdbcType=VARCHAR}, #{ret, mode=OUT, jdbcType=INTEGER}, #{ext, mode=OUT, jdbcType=VARCHAR})-->
    <!--</select>-->

    <select id="callFanboardHistory" parameterType="com.dalbit.member.vo.procedure.P_MemberFanboardInputVo" resultType="com.dalbit.member.vo.procedure.P_MemberFanboardOutputVo">
        select @rownum := @rownum + 1 as rowNum
          , idx
          , board_no
          , depth
          , writer_no
          , status
          ,(select image_profile From rd_data.tb_member_profile where mem_no = a.mem_no) as image_profile
          ,mem_no
          ,(select mem_userid From rd_data.tb_member_basic where mem_no = a.mem_no) as mem_userid
          ,(select mem_nick From rd_data.tb_member_basic where mem_no = a.mem_no) as mem_nick
          ,(select mem_sex From rd_data.tb_member_basic where mem_no = a.mem_no) as mem_sex
          ,last_upd_date
          , contents
          ,(select count(*) as cnt from rd_data.tb_member_fanboard where board_no = a.board_no and depth !='1') replyCnt
          from rd_data.tb_member_fanboard a ,(select @rownum := #{pageNo}) b
         where writer_no = #{mem_no}
            and depth='1'
         ORDER BY a.last_upd_date DESC
          limit #{pageNo}, #{pageCnt}
    </select>

    <select id="callFanboardHistory_totalCnt" parameterType="com.dalbit.member.vo.procedure.P_MemberFanboardInputVo" resultType="integer">
        select count(*) totalCnt from rd_data.tb_member_fanboard where writer_no = #{mem_no}
    </select>


    <select id="callFanboardReplyList" parameterType="com.dalbit.member.vo.procedure.P_MemberFanboardInputVo" resultType="com.dalbit.member.vo.procedure.P_MemberFanboardOutputVo">
        SELECT a.idx idx,
              a.board_no,
              a.writer_no,
              b.mem_nick,
              b.mem_userid,
              b.mem_sex,
              ( SELECT image_profile FROM rd_data.tb_member_profile WHERE mem_no = a.writer_no ) AS image_profile,
              a.contents,
              a.status,
              a.last_upd_date
            from
              ( select idx, board_no, contents, writer_no, status, last_upd_date from rd_data.tb_member_fanboard where mem_no = #{mem_no} AND depth = #{depth} ) AS a LEFT JOIN rd_data.tb_member_basic AS b
                ON a.writer_no = b.mem_no
            where a.status = 1
            order BY a.last_upd_date DESC
    </select>

</mapper>