<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalbit.member.dao.M_BroadcastDao" >


    <select id="callBroadList" resultType="com.dalbit.member.vo.BroadListVo">
        /* M_Broadcast.xml - callBroadList */
        SELECT
          b.subject_type
          , b.title
          , b.start_date
          , b.end_date
          , b.airtime
          , m.listener
          , m.good
          , m.gold
          , @RNUM := @RNUM + 1 as rowNum
        FROM tb_broadcast_room b
          , tb_member_broadcast_broadcasting m
          , (SELECT @RNUM := #{pageStart}) r
        WHERE b.room_no = m.room_no
        ORDER BY ${orderColumnName} ${orderDir}
         limit #{pageStart}, #{pageCnt}
    </select>

    <select id="callBroadHistory_detail" parameterType="com.dalbit.member.vo.BroadListVo" resultType="com.dalbit.member.vo.BroadListVo">
        /* M_Broadcast.xml - callBroadHistory_detail */
        SELECT b.room_no as roomNo
            ,(SELECT aa.code From tbl_code_define aa WHERE aa.type='subject_type' and aa.value = lpad(b.subject_type,2,'0')) as subjectType
            , b.title as title
            , DATE_FORMAT(b.start_date,'%Y-%m-%d %H:%i:%s') as startDate
            , DATE_FORMAT(b.end_date,'%Y-%m-%d %H:%i:%s') as endDate
            , TIME_FORMAT(SEC_TO_TIME(m.airtime), '%H시간 %i분 %s초') as  airtime
            , m.listener as listener
            , m.good
            , m.gold
          , @RNUM := @RNUM + 1 as rowNum
        FROM tb_broadcast_room b, tb_member_broadcast_broadcasting m
           , (SELECT @RNUM := #{pageStart}) r
       WHERE b.room_no = m.room_no
         AND b.mem_no = #{memNo}

      ORDER BY ${orderColumnName} ${orderDir}
        limit #{pageStart}, #{pageCnt}
    </select>


</mapper>