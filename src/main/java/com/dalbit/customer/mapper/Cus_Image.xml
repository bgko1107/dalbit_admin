<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalbit.customer.dao.Cus_ImageDao">

    <sql id="profile">
        SELECT
            a.mem_no,
            a.mem_userid,
            a.mem_nick,
            a.mem_birth_year,
            a.mem_birth_month,
            a.mem_birth_day,
            a.mem_name,
            a.mem_phone,
            a.mem_slct,
            a.mem_sex,
            a.mem_join_date as joinDate,
            IFNULL(b.image_profile, '') AS image_profile,
            a.last_upd_date
        FROM
            rd_data.tb_member_basic AS a
		LEFT JOIN rd_data.tb_member_profile AS b ON a.mem_no = b.mem_no
    </sql>

    <!-- 프로필 -->
    <select id="callCustomerImageProfileListCnt" parameterType="com.dalbit.customer.vo.procedure.P_ImageProfileListInputVo" resultType="java.lang.Integer">
        SELECT
          COUNT(*)
        FROM
          rd_data.tb_member_basic
        <where>
            <if test='searchText != null and searchText != ""'>
                <choose>
                    <when test='searchType == 1'>
                        AND mem_no like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 2'>
                        AND mem_name like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 3'>
                        AND mem_userid like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 4'>
                        AND mem_nick like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 5'>
                        AND mem_phone like CONCAT('%',#{searchText},'%')
                    </when>
                    <otherwise>
                        AND (mem_no like CONCAT('%',#{searchText},'%') OR mem_name like CONCAT('%',#{searchText},'%') OR mem_userid like CONCAT('%',#{searchText},'%') OR mem_nick like CONCAT('%',#{searchText},'%') OR mem_phone like CONCAT('%',#{searchText},'%'))
                    </otherwise>
                </choose>
            </if>
        </where>
    </select>

    <select id="callCustomerImageProfileList" parameterType="com.dalbit.customer.vo.procedure.P_ImageProfileListInputVo" resultType="com.dalbit.customer.vo.procedure.P_ImageProfileListOutputVo">
        select *
        from (
            select
            @rownum := @rownum + 1 as rowNum,
            a.*
            FROM
            (
            <include refid="profile"/>
            <where>
                <if test='searchText != null and searchText != ""'>
                    <choose>
                        <when test='searchType == 1'>
                            AND a.mem_no like CONCAT('%',#{searchText},'%')
                        </when>
                        <when test='searchType == 2'>
                            AND a.mem_name like CONCAT('%',#{searchText},'%')
                        </when>
                        <when test='searchType == 3'>
                            AND a.mem_userid like CONCAT('%',#{searchText},'%')
                        </when>
                        <when test='searchType == 4'>
                            AND a.mem_nick like CONCAT('%',#{searchText},'%')
                        </when>
                        <when test='searchType == 5'>
                            AND a.mem_phone like CONCAT('%',#{searchText},'%')
                        </when>
                        <otherwise>
                            AND (a.mem_no like CONCAT('%',#{searchText},'%') OR a.mem_name like CONCAT('%',#{searchText},'%') OR a.mem_userid like CONCAT('%',#{searchText},'%') OR a.mem_nick like CONCAT('%',#{searchText},'%') OR a.mem_phone like CONCAT('%',#{searchText},'%'))
                        </otherwise>
                    </choose>
                </if>
            </where>
            ) AS a,
            (select @rownum := 0) AS b
            <trim prefix="ORDER BY">
                a.last_upd_date desc
            </trim>
        ) b
        where rowNum between #{searchStartNo, jdbcType=INTEGER} and #{searchEndNo, jdbcType=INTEGER}
    </select>


    <sql id="broadcast">
        SELECT
            a.mem_no
            , a.room_no
            , a.subject_type
            , a.title
            , a.image_background
            , a.state
            , a.start_date
            , b.mem_userid
            , b.mem_nick
            , b.mem_name
            , b.mem_phone
            , b.mem_slct
            , b.mem_sex
            , a.last_upd_date
            , b.mem_birth_year
            , b.mem_birth_month
            , b.mem_birth_day
        FROM rd_data.tb_broadcast_room AS a
        LEFT JOIN
            rd_data.tb_member_basic AS b
        ON
            a.mem_no = b.mem_no
    </sql>

    <select id="callCustomerImageBroadcastListCnt" parameterType="com.dalbit.customer.vo.procedure.P_ImageBroadcastListInputVo" resultType="java.lang.Integer">
        SELECT
          COUNT(*)
        FROM
          rd_data.tb_broadcast_room AS a
        LEFT JOIN
          rd_data.tb_member_basic AS b
        ON
          a.mem_no = b.mem_no
        <where>
            a.state != 4
            <if test='searchText != null and searchText != ""'>
                <choose>
                    <when test='searchType == 1'>
                        AND b.mem_no like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 2'>
                        AND b.mem_name like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 3'>
                        AND b.mem_userid like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 4'>
                        AND b.mem_nick like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 5'>
                        AND b.mem_phone like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 6'>
                        AND a.title like CONCAT('%',#{searchText},'%')
                    </when>
                    <otherwise>
                        AND (b.mem_no like CONCAT('%',#{searchText},'%') OR b.mem_name like CONCAT('%',#{searchText},'%') OR b.mem_userid like CONCAT('%',#{searchText},'%') OR b.mem_nick like CONCAT('%',#{searchText},'%') OR b.mem_phone like CONCAT('%',#{searchText},'%') OR a.title like CONCAT('%',#{searchText},'%'))
                    </otherwise>
                </choose>
            </if>
        </where>
    </select>

    <select id="callCustomerImageBroadcastList" parameterType="com.dalbit.customer.vo.procedure.P_ImageBroadcastListInputVo" resultType="com.dalbit.customer.vo.procedure.P_ImageBroadcastListOutputVo">
        select *
        from (
        select
        @rownum := @rownum + 1 as rowNum,
        a.*
        FROM
        (
        <include refid="broadcast"/>
        <where>
            a.state != 4
            <if test='searchText != null and searchText != ""'>
                <choose>
                    <when test='searchType == 1'>
                        AND b.mem_no like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 2'>
                        AND b.mem_name like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 3'>
                        AND b.mem_userid like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 4'>
                        AND b.mem_nick like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 5'>
                        AND b.mem_phone like CONCAT('%',#{searchText},'%')
                    </when>
                    <when test='searchType == 6'>
                        AND a.title like CONCAT('%',#{searchText},'%')
                    </when>
                    <otherwise>
                        AND (b.mem_no like CONCAT('%',#{searchText},'%') OR b.mem_name like CONCAT('%',#{searchText},'%') OR b.mem_userid like CONCAT('%',#{searchText},'%') OR b.mem_nick like CONCAT('%',#{searchText},'%') OR b.mem_phone like CONCAT('%',#{searchText},'%') OR a.title like CONCAT('%',#{searchText},'%'))
                    </otherwise>
                </choose>
            </if>
        </where>
        ) AS a,
        (select @rownum := 0) AS b
        <trim prefix="ORDER BY">
            a.last_upd_date DESC
        </trim>
        ) b
        where rowNum between #{searchStartNo, jdbcType=INTEGER} and #{searchEndNo, jdbcType=INTEGER}
    </select>



</mapper>